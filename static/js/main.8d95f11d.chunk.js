(this["webpackJsonptempo-of-darkness"]=this["webpackJsonptempo-of-darkness"]||[]).push([[0],{17:function(e,t,n){},18:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(10),s=n.n(a),o=n(7),i=n(2),u=n(3),l=n.n(u),j=n(6),f=n(4),h=(n(24),n(25),"38587"),b="21eef78849844426a9855a108fc1ba3a",p="https://www.bungie.net/Platform";function d(e,t,n){return O.apply(this,arguments)}function O(){return(O=Object(j.a)(l.a.mark((function e(t,n,r){var c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return console.log("user missing!"),e.abrupt("return");case 3:return c=new URLSearchParams(r),a="".concat(p).concat(t,"?").concat(c),e.abrupt("return",fetch(a,{method:"GET",headers:{"X-API-Key":b,Authorization:"Bearer "+n.accessToken.value}}).then((function(e){return e.ok?e.json():Promise.reject(e)})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=Object(j.a)(l.a.mark((function e(t){var n,r,c,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return console.log("user missing!"),e.abrupt("return");case 3:return e.next=5,d("/Destiny2/Manifest/",t);case 5:return n=e.sent,r=n.Response,c=r.jsonWorldContentPaths.en,e.next=10,fetch("https://www.bungie.net".concat(c));case 10:return a=e.sent,e.next=13,a.json();case 13:return s=e.sent,e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v="authorization";function g(){var e=localStorage.getItem(v);return e?JSON.parse(e):null}function y(e){localStorage.setItem(v,JSON.stringify(e))}function k(e){if(!e)return!0;var t=function(e){return e&&Object.prototype.hasOwnProperty.call(e,"inception")&&Object.prototype.hasOwnProperty.call(e,"expires")?e.inception+1e3*e.expires:0}(e);return Date.now()>t}var w=n(1),S={user:null,setUser:function(){return null},profile:null,setProfile:function(){return null}},N=Object(r.createContext)(S),P=function(e){var t=e.children,n=Object(r.useState)(null),c=Object(f.a)(n,2),a=c[0],s=c[1],o=Object(r.useState)(null),i=Object(f.a)(o,2),u=i[0],l=i[1],j=Object(r.useCallback)((function(e){null===e?localStorage.removeItem(v):y(e),s(e)}),[]);Object(r.useEffect)((function(){var e=g();e&&(k(e.accessToken)||s(e))}),[]);var h=Object(r.useMemo)((function(){return{user:a,setUser:j,profile:u,setProfile:l}}),[u,j,a]);return Object(w.jsx)(N.Provider,{value:h,children:t})},D={manifest:null},C=Object(r.createContext)(D),_=function(e){var t=e.children,n=Object(r.useContext)(N).user,c=Object(r.useState)(null),a=Object(f.a)(c,2),s=a[0],o=a[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(n);case 2:t=e.sent,(r={}).DestinyClassDefinition=t.DestinyClassDefinition,r.DestinyInventoryItemDefinition=t.DestinyInventoryItemDefinition,o(r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n&&function(){e.apply(this,arguments)}()}),[n]);var i=Object(r.useMemo)((function(){return{manifest:s}}),[s]);return Object(w.jsx)(C.Provider,{value:i,children:t})},I="".concat(p,"/App/OAuth/Token/");function T(e){var t=new URLSearchParams({grant_type:"authorization_code",code:e,client_id:h});return Promise.resolve(fetch(I,{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then(A))}function A(e){if(null===e||void 0===e?void 0:e.access_token){var t=e,n=Date.now(),r={accessToken:{value:t.access_token,expires:t.expires_in,name:"access",inception:n},bungieMembershipId:t.membership_id};return t.refresh_token&&(r.refreshToken={value:t.refresh_token,expires:t.refresh_expires_in,name:"refresh",inception:n}),r}throw new Error("No data or access token in response: "+JSON.stringify(e))}var E=function(){var e=Object(i.f)(),t=Object(o.c)(),n=Object(f.a)(t,1)[0],c=Object(r.useContext)(N).setUser,a=Object(r.useCallback)(function(){var t=Object(j.a)(l.a.mark((function t(n,r){var a,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=localStorage.getItem("authorizationState")){t.next=4;break}return console.log("No stored state :("),t.abrupt("return");case 4:if(a===r){t.next=7;break}return console.log("State mismatch :("),t.abrupt("return");case 7:return t.prev=7,t.next=10,T(n);case 10:s=t.sent,c(s),e("/"),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(7),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[7,15]])})));return function(e,n){return t.apply(this,arguments)}}(),[e,c]);return Object(r.useEffect)((function(){var e=n.get("code"),t=n.get("state");e?t?a(e,t):console.log("No state from Bungie :("):console.log("No auth code from Bungie :(")}),[a,n]),Object(w.jsx)(w.Fragment,{children:Object(w.jsx)("div",{children:Object(w.jsx)("h2",{children:"Welcome to the callback!"})})})},z=n(26),H=(n(17),function(){var e=Object(r.useMemo)((function(){var e=Object(z.a)();localStorage.setItem("authorizationState",e);var t=new URLSearchParams({client_id:h,response_type:"code",state:e});return"https://www.bungie.net/en/OAuth/Authorize?".concat(t)}),[]);return Object(w.jsx)("a",{className:"Login",rel:"noopener noreferrer",onClick:function(){console.log("login")},href:e,children:"Authorize with Bungie.net"})}),U=(n(18),function(){var e=Object(r.useContext)(C).manifest,t=Object(r.useContext)(N),n=t.user,c=t.setUser,a=t.setProfile,s=Object(r.useState)(),o=Object(f.a)(s,2),i=o[0];o[1];return Object(r.useEffect)((function(){}),[a,n]),Object(r.useEffect)((function(){console.log(e)}),[e]),Object(w.jsxs)("div",{className:"Home",children:[Object(w.jsx)("div",{className:"Home-stars"}),Object(w.jsxs)("div",{className:"Home-container",children:[Object(w.jsx)("h1",{className:"Home-title",children:"Tempo of Darkness"}),n?Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("p",{className:"Home-text",children:"Next, choose a character to use on your adventure. Your playthrough will feature items currently equipped on that character, as well as items from your vault:"}),i&&Object.entries(i).map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];return Object(w.jsxs)("div",{children:[Object(w.jsx)("div",{children:r.light}),Object(w.jsx)("img",{src:"https://bungie.net".concat(r.emblemBackgroundPath),alt:"char"})]},"char-".concat(n))})),Object(w.jsx)("button",{onClick:function(){c(null)},children:"logout"})]}):Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("p",{className:"Home-text",children:"A Destiny themed, card-based, deck-building, roguelike adventure"}),Object(w.jsx)("p",{className:"Home-text",children:"Tempo of Darkness uses your Destiny characters and vault as the foundation for cards you find in a playthrough. To start an adventure, first allow ToD to view your Destiny info:"}),Object(w.jsx)(H,{})]})]})]})}),B=function(){return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("div",{children:Object(w.jsx)("h2",{children:"Not Found!"})}),Object(w.jsx)("div",{children:Object(w.jsx)(o.b,{to:"/",children:"Return home"})})]})},M=(n(19),function(){return Object(w.jsx)(P,{children:Object(w.jsx)(_,{children:Object(w.jsx)("div",{className:"App",children:Object(w.jsxs)(i.c,{children:[Object(w.jsx)(i.a,{path:"/",element:Object(w.jsx)(U,{})}),Object(w.jsx)(i.a,{path:"/callback",element:Object(w.jsx)(E,{})}),Object(w.jsx)(i.a,{path:"*",element:Object(w.jsx)(B,{})})]})})})})});n(20);s.a.render(Object(w.jsx)(c.a.StrictMode,{children:Object(w.jsx)(o.a,{children:Object(w.jsx)(M,{})})}),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.8d95f11d.chunk.js.map